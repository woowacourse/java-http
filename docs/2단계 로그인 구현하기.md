# ğŸš€ 2ë‹¨ê³„ - ë¡œê·¸ì¸ êµ¬í˜„í•˜ê¸°

# ë¯¸ì…˜ ì„¤ëª…

ì„œë¸”ë¦¿ì„ ë„ì…í•´ì„œ ë™ì  í˜ì´ì§€ë¥¼ ë§Œë“¤ ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤.
ì´ì œ ë¡œê·¸ì¸ê³¼ íšŒì›ê°€ì… ê¸°ëŠ¥ì„ ì¶”ê°€í•´ë³´ì.
ë¡œê·¸ì¸ì— í•„ìš”í•œ ì¿ í‚¤ì™€ ì„¸ì…˜ë„ ê°™ì´ êµ¬í˜„í•´ë³´ì.

# ê¸°ëŠ¥ ìš”êµ¬ ì‚¬í•­

## 1. HTTP Status Code 302

ë¡œê·¸ì¸ ì—¬ë¶€ì— ë”°ë¼ ë‹¤ë¥¸ í˜ì´ì§€ë¡œ ì´ë™ì‹œì¼œë³´ì.
`/login` í˜ì´ì§€ì—ì„œ ì•„ì´ë””ëŠ” gugu, ë¹„ë°€ë²ˆí˜¸ëŠ” passwordë¥¼ ì…ë ¥í•˜ì.
ë¡œê·¸ì¸ì— ì„±ê³µí•˜ë©´ ì‘ë‹µ í—¤ë”ì— **http status code**ë¥¼ **302**ë¡œ ë°˜í™˜í•˜ê³  `/index.html`ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ í•œë‹¤.
ë¡œê·¸ì¸ì— ì‹¤íŒ¨í•˜ë©´ `401.html`ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸í•œë‹¤.

## ì‹¤í–‰ ê²°ê³¼

![Jun-16-2022 14-16-51.gif](https://techcourse-storage.s3.ap-northeast-2.amazonaws.com/fac9942f8feb489f89d51bc8df0765d4)

# 

## 2. POST ë°©ì‹ìœ¼ë¡œ íšŒì›ê°€ì…

http://localhost:8080/registerìœ¼ë¡œ ì ‘ì†í•˜ë©´ íšŒì›ê°€ì… í˜ì´ì§€(register.html)ë¥¼ ë³´ì—¬ì¤€ë‹¤.
íšŒì›ê°€ì… í˜ì´ì§€ë¥¼ ë³´ì—¬ì¤„ ë•ŒëŠ” GETì„ ì‚¬ìš©í•œë‹¤.
íšŒì›ê°€ì…ì„ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ HTTP methodë¥¼ GETì´ ì•„ë‹Œ **POST**ë¥¼ ì‚¬ìš©í•œë‹¤.
íšŒì›ê°€ì…ì„ ì™„ë£Œí•˜ë©´ `index.html`ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸í•œë‹¤.
ë¡œê·¸ì¸ í˜ì´ì§€ë„ ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ GET ë°©ì‹ì—ì„œ POST ë°©ì‹ìœ¼ë¡œ ì „ì†¡í•˜ë„ë¡ ë³€ê²½í•˜ì.

## ì‹¤í–‰ ê²°ê³¼

![Jun-16-2022 15-55-04.gif](https://techcourse-storage.s3.ap-northeast-2.amazonaws.com/e2192f63bc394d3f95d0009e63178f71)

# 

## 3. Cookieì— JSESSIONID ê°’ ì €ì¥í•˜ê¸°

ë¡œê·¸ì¸ì— ì„±ê³µí•˜ë©´ ì¿ í‚¤ì™€ ì„¸ì…˜ì„ í™œìš©í•´ì„œ ë¡œê·¸ì¸ ìƒíƒœë¥¼ ìœ ì§€í•´ì•¼ í•œë‹¤.
HTTP ì„œë²„ëŠ” ì„¸ì…˜ì„ ì‚¬ìš©í•´ì„œ ì„œë²„ì— ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ ì €ì¥í•œë‹¤.
ì„¸ì…˜ì„ êµ¬í˜„í•˜ê¸° ì „ì— ë¨¼ì € ì¿ í‚¤ë¥¼ êµ¬í˜„í•´ë³¸ë‹¤.

ìë°” ì§„ì˜ì—ì„œ ì„¸ì…˜ ì•„ì´ë””ë¥¼ ì „ë‹¬í•˜ëŠ” ì´ë¦„ìœ¼ë¡œ `JSESSIONID`ë¥¼ ì‚¬ìš©í•œë‹¤.

ì„œë²„ì—ì„œ HTTP ì‘ë‹µì„ ì „ë‹¬í•  ë•Œ ì‘ë‹µ í—¤ë”ì— `Set-Cookie`ë¥¼ ì¶”ê°€í•˜ê³  `JSESSIONID=656cef62-e3c4-40bc-a8df-94732920ed46` í˜•íƒœë¡œ ê°’ì„ ì „ë‹¬í•˜ë©´ í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ í—¤ë”ì˜ `Cookie` í•„ë“œì— ê°’ì´ ì¶”ê°€ëœë‹¤.

ì„œë²„ë¡œë¶€í„° ì¿ í‚¤ ì„¤ì •ëœ í´ë¼ì´ì–¸íŠ¸ì˜ HTTP Request Header ì˜ˆì‹œ

```plaintext
GET /index.html HTTP/1.1
Host: localhost:8080
Connection: keep-alive
Accept: */*
Cookie: yummy_cookie=choco; tasty_cookie=strawberry; JSESSIONID=656cef62-e3c4-40bc-a8df-94732920ed46
```

Cookie í´ë˜ìŠ¤ë¥¼ ì¶”ê°€í•˜ê³  HTTP Request Headerì˜ Cookieì— `JSESSIONID`ê°€ ì—†ìœ¼ë©´ HTTP Response Headerì— `Set-Cookie`ë¥¼ ë°˜í™˜í•´ì£¼ëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„í•œë‹¤.

```plaintext
HTTP/1.1 200 OK 
Set-Cookie: JSESSIONID=656cef62-e3c4-40bc-a8df-94732920ed46
Content-Length: 5571
Content-Type: text/html;charset=utf-8;
```

## ì‹¤í–‰ ê²°ê³¼

![Jun-16-2022 17-18-10.gif](https://techcourse-storage.s3.ap-northeast-2.amazonaws.com/3129af4863e34556b6bc73ac63bb6bc0)

# 

## 4. Session êµ¬í˜„í•˜ê¸°

ì¿ í‚¤ì—ì„œ ì „ë‹¬ ë°›ì€ `JSESSIONID`ì˜ ê°’ìœ¼ë¡œ ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ ì²´í¬í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.
ë¡œê·¸ì¸ì— ì„±ê³µí•˜ë©´ Session ê°ì²´ì˜ ê°’ìœ¼ë¡œ `User` ê°ì²´ë¥¼ ì €ì¥í•´ë³´ì.

ê·¸ë¦¬ê³  ë¡œê·¸ì¸ëœ ìƒíƒœì—ì„œ `/login` í˜ì´ì§€ì— HTTP GET methodë¡œ ì ‘ê·¼í•˜ë©´ ì´ë¯¸ ë¡œê·¸ì¸í•œ ìƒíƒœë‹ˆ `index.html` í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì²˜ë¦¬í•œë‹¤.

# ì²´í¬ë¦¬ìŠ¤íŠ¸

- HTTP Reponseì˜ ìƒíƒœ ì‘ë‹µ ì½”ë“œë¥¼ 302ë¡œ ë°˜í™˜í•œë‹¤.
- POSTë¡œ ë“¤ì–´ì˜¨ ìš”ì²­ì˜ Request Bodyë¥¼ íŒŒì‹±í•  ìˆ˜ ìˆë‹¤.
- ë¡œê·¸ì¸ì— ì„±ê³µí•˜ë©´ HTTP Reponseì˜ í—¤ë”ì— Set-Cookieê°€ ì¡´ì¬í•œë‹¤.
- ì„œë²„ì— ì„¸ì…˜ì„ ê´€ë¦¬í•˜ëŠ” í´ë˜ìŠ¤ê°€ ìˆê³ , ì¿ í‚¤ë¡œë¶€í„° ì „ë‹¬ ë°›ì€ JSESSIONID ê°’ì´ ì €ì¥ëœë‹¤.

# íŒíŠ¸

## 1. HTTP Status Code 302

[Mozilla ë¬¸ì„œ](https://developer.mozilla.org/ko/docs/Web/HTTP/Status/302)ë¥¼ ì°¸ê³ í•´ì„œ HTTP Responseë¥¼ ìˆ˜ì •í•´ë³´ì.

## 2. POST ë°©ì‹ìœ¼ë¡œ íšŒì›ê°€ì…

ë¸Œë¼ìš°ì €ì—ì„œ HTTP ìš”ì²­ì„ ë‹¤ìŒê³¼ ê°™ì´ ë³´ë‚¸ë‹¤.

```plaintext
POST /register HTTP/1.1
Host: localhost:8080
Connection: keep-alive
Content-Length: 80
Content-Type: application/x-www-form-urlencoded
Accept: */*

account=gugu&password=password&email=hkkang%40woowahan.com
```

1. while ë¬¸ìœ¼ë¡œ http request headerë¥¼ ì½ê³  ë‚˜ì„œ request bodyë¥¼ ì½ì–´ì˜¨ë‹¤.
   - request headerì˜ **Content-Length**ê°€ request bodyì˜ lengthë‹¤.

```java
int contentLength = Integer.parseInt(httpRequestHeaders.get("Content-Length"));
char[] buffer = new char[contentLength];
reader.read(buffer, 0, contentLength);
String requestBody = new String(buffer);
```

1. **POST**ë¡œ ì „ë‹¬í•˜ë©´ GETê³¼ ë‹¤ë¥´ê²Œ `http request body`ì— ë°ì´í„°ê°€ ë‹´ê¸´ë‹¤.
2. `login.html`ë„ form íƒœê·¸ë¥¼ ìˆ˜ì •í•œë‹¤.
3. InMemoryUserRepositoryì—ì„œ save ë©”ì„œë“œë¥¼ ì‚¬ìš©í•´ì„œ ê°€ì… ì™„ë£Œ ì²˜ë¦¬í•œë‹¤.
4. ì´ìƒ ì—†ìœ¼ë©´ ë¦¬ë‹¤ì´ë ‰íŠ¸

## 3. Cookieì— JSESSIONID ê°’ ì €ì¥í•˜ê¸°

ìë°”ì—ì„œ UUID í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ë©´ ê³ ìœ í•œ ì•„ì´ë””ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

```java
UUID uuid = UUID.randomUUID();
public class HttpCookie {
    ...
    // ì•„ë˜ì™€ ê°™ì€ ì¿ í‚¤ ê°’ì„ íŒŒì‹±í•´ì„œ mapìœ¼ë¡œ ì €ì¥í•œë‹¤.
    // yummy_cookie=choco; tasty_cookie=strawberry; JSESSIONID=656cef62-e3c4-40bc-a8df-94732920ed46
}
```

## 4. Session êµ¬í˜„í•˜ê¸°

ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ì˜ ì„¸ì…˜ ê°’ì„ ê´€ë¦¬í•˜ëŠ” í´ë˜ìŠ¤ë¥¼ ì¶”ê°€í•œë‹¤.
ê° ì„¸ì…˜ì˜ idëŠ” `uuid`ë¥¼ ì‚¬ìš©í•œë‹¤

```java
...
import org.apache.catalina.Manager;
...
public class SessionManager implements Manager {

    // static!
    private static final Map<String, Session> SESSIONS = new HashMap<>();

    @Override
    public void add(final Session session) {
        ...
    }

    @Override
    public Session findSession(final String id) {
        ...
    }

    @Override
    public void remove(final String id) {
        ...
    }

    private SessionManager() {}
}
```

í´ë¼ì´ì–¸íŠ¸ë³„ ì„¸ì…˜ ë°ì´í„°ë¥¼ ê´€ë¦¬í•˜ëŠ” ì„¸ì…˜ í´ë˜ìŠ¤ë¥¼ ì¶”ê°€í•œë‹¤.

```java
public class Session {

    private final String id;
    private final Map<String, Object> values = new HashMap<>();

    public Session(final String id) {
        ...
    }

    public String getId() {
        ...
    }

    public Object getAttribute(final String name) {
        ...
    }

    public void setAttribute(final String name, final Object value) {
        ...
    }

    public void removeAttribute(final String name) {
        ...
    }

    public void invalidate() {
        ...
    }
}
```

ë¡œê·¸ì¸ì„ êµ¬í˜„í•  ë•Œ ì°¸ê³ í•œë‹¤.

```java
if (user.checkPassword(password)) {
    final var session = request.getSession(true);
    session.setAttribute("user", user);
    response.addCookie(Cookies.ofJSessionId(session.getId()));
    response.sendRedirect("/index.html");
    return;
}
    private User getUser(Session session) {
        return (User) session.getAttribute("user");
    }
```